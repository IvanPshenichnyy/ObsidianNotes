# Правила создания общих модулей

#std469

> _Область применения: управляемое приложение, мобильное приложение, обычное приложение._

1.1. Общие модули создаются для реализации процедур и функций, объединенных по некоторому признаку. Как правило, в один общий модуль помещаются процедуры и функции [одной подсистемы конфигурации](https://its.1c.ru/db/v8std/content/543/hdoc) (продажи, закупки) или процедуры и функции сходного функционального назначения (работа со строками, общего назначения).

1.2. При разработке общих модулей следует выбирать один из четырех контекстов выполнения кода:

|     |                                |                                                         |                   |            |                        |                                      |                                          |
| --- | ------------------------------ | ------------------------------------------------------- | ----------------- | ---------- | ---------------------- | ------------------------------------ | ---------------------------------------- |
|     | **Тип общего модуля**          | **Пример наименования**                                 | **Вызов сервера** | **Сервер** | **Внешнее соединение** | **Клиент  <br>(обычное приложение)** | **Клиент  <br>(управляемое приложение)** |
| 1.  | Серверный                      | ОбщегоНазначения (или ОбщегоНазначенияСервер)           |                   | +          | +                      | +                                    |                                          |
| 2.  | Серверный для вызова с клиента | ОбщегоНазначенияВызовСервера                            | +                 | +          |                        |                                      |                                          |
| 3.  | Клиентский                     | ОбщегоНазначенияКлиент (или ОбщегоНазначенияГлобальный) |                   |            |                        | +                                    | +                                        |
| 4.  | Клиент-серверный               | ОбщегоНазначенияКлиентСервер                            |                   | +          | +                      | +                                    | **+**                                    |

2.1. **Серверные общие модули** предназначены для размещения серверных процедур и функций, не доступных для использования из клиентского кода. В них реализуется вся внутренняя серверная бизнес-логика приложения.  
Для корректной работы конфигурации в режимах внешнего соединения, управляемого и обычного приложений, серверные процедуры и функции следует размещать в общих модулях с признаками:

- **Сервер** (флажок **Вызов сервера** снят),
- **Клиент (обычное приложение)**,
- **Внешнее соединение**. 

В таком случае гарантируется возможность вызова серверных процедур и функций с параметрами мутабельных типов (например, **СправочникОбъект**, **ДокументОбъект** и т.п.). Как правило, это:

- обработчики подписок на события документов, справочников и т.п., которые принимают в качестве параметра мутабельное значение (объект). 
- серверные процедуры и функции, в которые в качестве параметра передается объект из модулей справочников, документов и пр., а также из модулей с подписками на события.

Серверные общие модули называются по [общим правилам именования объектов метаданных](https://its.1c.ru/db/v8std/content/474/hdoc).  
Например: **РаботаСФайлами**, **FilesOperations**.

В отдельных случаях для предотвращения конфликта имен со свойствами глобального контекста может быть добавлен постфикс **"Сервер"** (англ. **"Server"**).  
Например: **РегламентныеЗаданияСервер**, **ScheduledJobsServer**.

2.2. **Серверные общие модули для вызова с клиента** содержат серверные процедуры и функции, доступные для использования из клиентского кода. Они составляют [клиентский программный интерфейс сервера приложения](https://its.1c.ru/db/v8std/content/src/500/i8100678.htm_).  
Такие процедуры и функции размещаются в общих модулях с признаком:

- **Сервер** (флажок **Вызов сервера** установлен)

Серверные общие модули для вызова с клиента называются по [общим правилам именования объектов метаданных](https://its.1c.ru/db/v8std/content/474/hdoc) и должны именоваться с постфиксом **"ВызовСервера"** (англ. **"ServerCall"**).  
Например: **РаботаСФайламиСлужебныйВызовСервера****,** **FilesOperationsInternalServerCall**.

Следует иметь в виду, что экспортные процедуры и функции в таких общих модулях не должны содержать параметров мутабельных типов (**СправочникОбъект**, **ДокументОбъект** и т.п.), так как их передача из (или в) клиентского кода невозможна.

> _См. также:_ _[Ограничение на установку признака «Вызов сервера» у общих модулей](https://its.1c.ru/db/v8std/content/src/500/i8100679.htm_), [Обеспечение совместимости библиотек](https://its.1c.ru/db/v8std/content/src/800/i8100644.htm_)_

2.3. **Клиентские общие модули** содержат клиентскую бизнес-логику (функциональность, определенную только для клиента) и имеют признаки:

- **Клиент (управляемое приложение)**,
- **Клиент (обычное приложение)**.

Исключение составляют случаи, когда клиентские процедуры и функции должны быть доступны только в режиме управляемого приложения (только в режиме обычного приложения или только в режиме внешнего соединения). В таких случаях, допустима иная комбинация двух этих признаков.

Клиентские общие модули именуются с постфиксом **"Клиент"** (англ. **"Client"**).  
Например: **РаботаСФайламиКлиент**, **FilesOperationsClient**.

> _См. также: [минимизация кода, выполняемого на клиенте](https://its.1c.ru/db/v8std/content/src/400/i8100629.htm_)_

2.4. Для того чтобы [избежать дублирования кода,](https://its.1c.ru/db/v8std/content/src/300/200/i8100440.htm_) рекомендуется создавать клиент-серверные общие модули с теми процедурами и функциями, содержание которых одинаково на сервере и на клиенте. Такие процедуры и функции размещаются в общих модулях с признаками:

- **Клиент (управляемое приложение)**,
- **Сервер** (флажок **Вызов сервера** сброшен),
- **Клиент (обычное приложение)**,
- **Внешнее соединение**.

Общие модули этого вида именуются с постфиксом **"КлиентСервер"** (англ. **"ClientServer"**).  
Например: **РаботаСФайламиКлиентСервер**, **FilesOperationsClientServer**.

В то же время, как только возникает необходимость ветвить код в клиент-серверных общих модулях на серверный и клиентский, то не следует [использовать для этого инструкции препроцессора](https://its.1c.ru/db/v8std/content/src/300/200/i8100439.htm_). Вместо этого, функциональность, различную для клиента и для сервера, рекомендуется реализовывать по общим правилам в модулях соответствующего типа – см. пп. 2.1 и 2.3. Такое явное разделение клиентской и серверной бизнес-логики продиктовано соображениями повышения модульности прикладного решения, упрощения контроля со стороны разработчика над клиент-серверным взаимодействием и снижением риска ошибок из-за принципиальных отличий требований к разработке клиентского и серверного кода (необходимость минимизации кода, выполняемого на клиенте, разной доступностью объектов и типов платформы и др.). При этом нужно иметь в виду неизбежное увеличение числа общих модулей в конфигурации.

> _Подробнее см.:_ [_Использование директив компиляции и инструкций препроцессора_](https://its.1c.ru/db/v8std/content/src/300/200/i8100439.htm_)

Особым случаем смешанных клиент-серверных модулей являются [модули форм](https://its.1c.ru/db/v8std/content/src/1%C2%A0100/700/i8100630.htm_) и команд, которые специально предназначены для реализации серверной и клиентской бизнес-логики в одном модуле.

3.1. Имена общих модулей рекомендуется строить по общим правилам именования объектов метаданных. Название общего модуля должно совпадать с названием подсистемы или отдельного механизма, процедуры и функции которой он реализует. Рекомендуется избегать в названиях общих модулей таких общих слов как "Процедуры", "Функции", "Обработчики", "Модуль", "Функциональность" и т.п. и применять их только в исключительных случаях, когда они более полно раскрывают назначение модуля.

Для того чтобы различать общие модули одной подсистемы, которые созданы для реализации процедур и функций, выполняемых в разных контекстах, рекомендуется задавать им постфиксы, описанные ранее в пп. 2.1-2.4.

3.2. Дополнительно к общим модулям могут быть добавлены уточняющие постфиксы.

3.2.1. Для глобальных модулей добавляется постфикс **"Глобальный"** (англ. **"Global"**), в этом случае постфикс **"Клиент"** добавлять не следует.  
Например: **РаботаСФайламиСлужебныйГлобальный****,** **FilesOperationsInternalGlobal**.

3.2.2. Модули, выполняющиеся в привилегированном режиме, имеющие признак **Привилегированный**, именуются с постфиксом **"ПолныеПрава"** (англ. **"FullAccess"**).  
Например: **РаботаСФайламиСлужебныйПолныеПрава**, **FilesOperationsInternalFullAccess**.

3.2.3. Модули, предназначенные для реализации на сервере или на клиенте функций с повторным использованием возвращаемых значений (на время вызова или на время сеанса), именуются с постфиксом **"ПовтИсп"** (англ. **"Cached"**) и **"КлиентПовтИсп"** (англ. **"ClientCached"**) соответственно.  
Например: **РаботаСФайламиСлужебныйКлиентПовтИсп**, **FilesOperationsInternalClientCached**.

> _См. также:_ _[Обеспечение совместимости библиотек](https://its.1c.ru/db/v8std/content/src/800/i8100644.htm_)_

3.2.4. Серверные и клиентские модули библиотечных конфигураций (которые предназначены не для самостоятельного использования, а для разработки других конфигураций) с процедурами и функциями, допускающие изменение своей реализации, именуются с постфиксами **"Переопределяемый"** (англ. **"Overridable"**) и **"КлиентПереопределяемый"** (англ. **"ClientOverridable"**).  
Например: **РаботаСФайламиКлиентПереопределяемый****,** **FilesOperationsClientOverridable**.

> _См. также: [Переопределяемые и поставляемые объекты библиотеки](https://its.1c.ru/db/v8std/content/src/800/i8100553.htm_)_

3.2.5. В [локализуемых конфигурациях](https://its.1c.ru/db/v8std/content/src/900/i8100769.htm_), на базе которых выпускаются национальные прикладные решения для различных стран или регионов, модули, реализующие национальную специфику, именуются с постфиксами **"Локализация"** (англ. **"Localization"**) и **"КлиентЛокализация"** (англ. **"Client****Localization****"**).  
Например: **ЭлктроннаяПодписьСлужебныйЛокализация****,** **ElectonicSignatureInternalLocalization**.

### См. также

- [Тексты модулей](https://its.1c.ru/db/v8std/content/src/300/100/i8100456.htm_)
- [Структура модуля](https://its.1c.ru/db/v8std/content/src/300/100/i8100455.htm_)